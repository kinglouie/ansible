# test code for the macos_pref module
# Copyright (c) 2018 - Matthias Hollerbach <mail@matthias-hollerbach.de>

# GNU General Public License v3 or later (see COPYING or https://www.gnu.org/licenses/gpl-3.0.txt )

- name: D_01 - delete root level key (create key)
  macos_pref:
    domain: com.ansible.test
    key: D_01
    value: value

- name: D_01 - delete root level key (delete key)
  macos_pref:
    domain: com.ansible.test
    key: D_01
    state: absent
  register: D_01_1

- name: D_01 - delete root level key (delete key idempotence)
  macos_pref:
    domain: com.ansible.test
    key: D_01
    state: absent
  register: D_01_2

- name: D_01 - delete root level key (read key)
  macos_pref:
    domain: com.ansible.test
    key: D_01
  register: D_01_3

- name: D_01 - delete root level key (assert)
  assert:
    that:
      - "D_01_1.changed"
      - "not D_01_2.changed"
      - "D_01_3.value == None"

#-------------

- name: D_02 - delete nested key (create key)
  macos_pref:
    domain: com.ansible.test
    key: D_02
    value:
      dict:
        key:
          - index0
          - key: value

- name: D_02 - delete nested key (delete key)
  macos_pref:
    domain: com.ansible.test
    key: D_02:dict:key:1:key
    state: absent
  register: D_02_1

- name: D_02 - delete nested key (delete key idempotence)
  macos_pref:
    domain: com.ansible.test
    key: D_02:dict:key:1:key
    state: absent
  register: D_02_2

- name: D_02 - delete nested key (read key)
  macos_pref:
    domain: com.ansible.test
    key: D_02:dict:key:1:key
  register: D_02_3

- name: D_02 - delete nested key (read parent key)
  macos_pref:
    domain: com.ansible.test
    key: D_02:dict:key:1
  register: D_02_4

- name: D_02 - delete nested key (assert)
  assert:
    that:
      - "D_02_1.changed"
      - "not D_02_2.changed"
      - "D_02_3.value == None"
      - "D_02_4.value != None"
